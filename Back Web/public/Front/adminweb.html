<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurante - Sistema de Gesti√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2196F3;
            --secondary-color: #FF9800;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #f44336;
            --info-color: #17a2b8;
            --dark-color: #333;
            --light-color: #f8f9fa;
            --white-color: #fff;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        /* ==========================================
           ESTILOS DE LOGIN
        ========================================== */
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .login-card {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 420px;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .login-card:hover {
            transform: translateY(-5px);
        }

        .login-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .login-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-input.error {
            border-color: var(--danger-color);
            background: #ffebee;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary-color), #1976D2);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .login-loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .role-selector {
            margin-bottom: 1.5rem;
        }

        .role-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .role-option {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            background: #f8f9fa;
        }

        .role-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .role-option.selected {
            border-color: var(--primary-color);
            background: rgba(33, 150, 243, 0.1);
            color: var(--primary-color);
        }

        .demo-credentials {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            font-size: 0.875rem;
            text-align: left;
        }

        .demo-credentials h4 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .demo-credential {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: white;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
        }

        /* ==========================================
           ESTILOS DEL SISTEMA PRINCIPAL
        ========================================== */

        .app-container {
            display: none;
        }

        .app-container.authenticated {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #1976D2);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.3);
            font-weight: bold;
        }

        .nav-tab:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-weight: bold;
            font-size: 1rem;
        }

        .user-role {
            font-size: 0.875rem;
            opacity: 0.9;
            text-transform: capitalize;
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success-color);
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background-color: var(--danger-color);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* ==========================================
           ESTAD√çSTICAS DASHBOARD
        ========================================== */

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card .icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
            opacity: 0.1;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .stat-card.danger .stat-number {
            color: var(--danger-color);
        }

        .stat-card.warning .stat-number {
            color: var(--warning-color);
        }

        .stat-card.success .stat-number {
            color: var(--success-color);
        }

        /* ==========================================
           PEDIDOS Y TARJETAS
        ========================================== */

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .order-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border-left: 6px solid var(--info-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .order-card.pendiente {
            border-left-color: var(--danger-color);
        }

        .order-card.preparando {
            border-left-color: var(--warning-color);
        }

        .order-card.listo {
            border-left-color: var(--success-color);
        }

        .order-card.entregando {
            border-left-color: var(--primary-color);
        }

        .order-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .order-mesa {
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--dark-color);
        }

        .order-time {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .order-total {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .order-status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
        }

        .status-pendiente {
            background: #ffebee;
            color: #c62828;
        }

        .status-preparando {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-listo {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-entregando {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* ==========================================
           ITEMS INDIVIDUALES
        ========================================== */

        .order-items {
            padding: 1.5rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }

        .order-item:hover {
            background: #e9ecef;
        }

        .order-item:last-child {
            margin-bottom: 0;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }

        .item-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .item-quantity {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .item-price {
            color: #666;
            font-weight: 500;
        }

        .item-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .item-observations {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            margin-top: 0.25rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .item-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .item-btn:hover {
            transform: translateY(-1px);
        }

        .item-btn.start {
            background: var(--warning-color);
            color: white;
        }

        .item-btn.finish {
            background: var(--success-color);
            color: white;
        }

        .item-btn.completed {
            background: #e8f5e8;
            color: var(--success-color);
            cursor: default;
        }

        .item-btn.completed:hover {
            transform: none;
        }

        /* ==========================================
           ACCIONES DE PEDIDO
        ========================================== */

        .order-actions {
            padding: 1.5rem;
            background: #f8f9fa;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .order-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: white;
            border-top: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .order-progress {
            display: flex;
            gap: 1rem;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .progress-count {
            background: var(--primary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-weight: bold;
        }

        .order-total-amount {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* ==========================================
           OBSERVACIONES Y ALERTAS
        ========================================== */

        .order-observations {
            margin: 1rem 1.5rem;
            padding: 1rem;
            background: #e3f2fd;
            border-left: 4px solid var(--info-color);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .order-observations .icon {
            color: var(--info-color);
            margin-right: 0.5rem;
        }

        .order-observations.urgent {
            background: #ffebee;
            border-left-color: var(--danger-color);
        }

        .order-observations.urgent .icon {
            color: var(--danger-color);
        }

        .kitchen-timer {
            background: var(--danger-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        /* ==========================================
           MODAL Y DETALLES
        ========================================== */

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            z-index: 1050;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* ==========================================
           UTILIDADES Y ESTADOS
        ========================================== */

        .no-orders {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .no-orders .icon {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        .no-orders h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #666;
        }

        .no-orders p {
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 3rem;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .notification.info {
            background: var(--info-color);
        }

        /* ==========================================
           RESPONSIVE DESIGN
        ========================================== */

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-container {
                padding: 0 1rem;
                margin: 1rem auto;
            }

            .orders-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .order-actions {
                flex-direction: column;
            }

            .btn {
                min-width: auto;
            }

            .login-card {
                padding: 2rem;
            }

            .user-info {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .role-options {
                grid-template-columns: 1fr;
            }

            .item-actions {
                flex-direction: column;
                gap: 0.25rem;
            }

            .order-summary {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .item-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-logo">üë®‚Äçüç≥</div>
            <h1 class="login-title">Sistema Cocina</h1>
            <p class="login-subtitle">Gesti√≥n de pedidos restaurante</p>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        required 
                        autocomplete="email"
                        placeholder="usuario@restaurante.com"
                    >
                    <div class="error-message" id="email-error"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Contrase√±a</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        required 
                        autocomplete="current-password"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    >
                    <div class="error-message" id="password-error"></div>
                </div>
                
                <div class="role-selector">
                    <label class="form-label">Tipo de acceso</label>
                    <div class="role-options">
                        <div class="role-option selected" data-role="cocina">
                            üë®‚Äçüç≥ Cocina
                        </div>
                        <div class="role-option" data-role="admin">
                            üë• Admin
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="login-btn" id="login-btn">
                    <span id="login-btn-text">Iniciar Sesi√≥n</span>
                </button>
                
                <div class="error-message" id="login-error"></div>
            </form>
            
            <!-- Credenciales demo -->
            <div class="demo-credentials">
                <h4>üß™ Credenciales de Prueba:</h4>
                <div class="demo-credential">
                    <strong>Admin:</strong> 
                    <span>admin@restaurante.com / admin123</span>
                </div>
                <div class="demo-credential">
                    <strong>Cocina:</strong> 
                    <span>cocina@restaurante.com / cocina123</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span>üçΩÔ∏è</span>
                    <span id="app-title">Sistema Cocina</span>
                </div>
                
                <nav class="nav-tabs">
                    <button class="nav-tab active" onclick="showSection('dashboard')" id="dashboard-tab">
                        üìä Dashboard
                    </button>
                    <button class="nav-tab" onclick="showSection('kitchen')" id="kitchen-tab">
                        üë®‚Äçüç≥ Cocina
                    </button>
                    <button class="nav-tab" onclick="showSection('admin')" id="admin-tab">
                        üë• Administraci√≥n
                    </button>
                    <button class="nav-tab" onclick="showSection('tables')" id="tables-tab">
                        ü™ë Mesas
                    </button>
                </nav>

                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name" id="user-name">Usuario</div>
                        <div class="user-role" id="user-role">Rol</div>
                    </div>
                    <div class="status-indicator">
                        <div class="status-dot" id="connection-dot"></div>
                        <span id="connection-status">Conectado</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        üö™ <span>Salir</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="main-container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-stats">
                    <div class="stat-card danger">
                        <div class="icon">‚ö†Ô∏è</div>
                        <div class="stat-number" id="pending-orders">0</div>
                        <div class="stat-label">Pedidos Pendientes</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="icon">üî•</div>
                        <div class="stat-number" id="preparing-orders">0</div>
                        <div class="stat-label">En Preparaci√≥n</div>
                    </div>
                    <div class="stat-card success">
                        <div class="icon">‚úÖ</div>
                        <div class="stat-number" id="ready-orders">0</div>
                        <div class="stat-label">Listos para Entregar</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">üí∞</div>
                        <div class="stat-number" id="total-sales">$0</div>
                        <div class="stat-label">Ventas del D√≠a</div>
                    </div>
                </div>

                <h2>üìà Resumen General</h2>
                <div id="dashboard-orders" class="orders-grid">
                    <!-- Las √≥rdenes se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </section>

            <!-- Kitchen Section -->
            <section id="kitchen" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>üë®‚Äçüç≥ Panel de Cocina</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <span style="font-weight: bold;">Auto-refresh:</span>
                        <button class="btn btn-success" id="auto-refresh-btn" onclick="toggleAutoRefresh()">
                            ‚úÖ Activo
                        </button>
                        <button class="btn btn-primary" onclick="refreshKitchenOrders()">
                            üîÑ Actualizar
                        </button>
                    </div>
                </div>
                
                <div id="kitchen-orders" class="orders-grid">
                    <!-- Las √≥rdenes de cocina se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </section>

            <!-- Admin Section -->
            <section id="admin" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>üë• Panel de Administraci√≥n</h2>
                    <button class="btn btn-primary" onclick="refreshOrders()">
                        üîÑ Actualizar
                    </button>
                </div>
                
                <div id="admin-orders" class="orders-grid">
                    <!-- Las √≥rdenes se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </section>

            <!-- Tables Section -->
            <section id="tables" class="content-section">
                <h2>ü™ë Gesti√≥n de Mesas</h2>
                <div id="tables-grid" class="tables-grid">
                    <!-- Las mesas se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </section>
        </div>
    </div>

    <!-- Modal de Detalles -->
    <div id="order-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Detalles del Pedido</h3>
                <button class="modal-close" onclick="closeOrderModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Contenido del modal se carga din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Notification Template -->
    <div id="notification" class="notification">
        <span id="notification-message"></span>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN Y ESTADOS GLOBALES
        // ==========================================
        
        const API_BASE_URL = 'http://200.54.216.197:3000/api';
        
        // Estado de autenticaci√≥n
        let currentUser = null;
        let authToken = null;
        let selectedRole = 'cocina';
        
        // Estado del sistema
        let currentSection = 'dashboard';
        let autoRefreshInterval = null;
        let orders = [];
        let tables = [];
        let isConnected = false;
        
        // Estados de pedido y sus prioridades
        const ORDER_STATES = {
            'pendiente': { priority: 1, label: 'Pendiente', color: 'danger' },
            'preparando': { priority: 2, label: 'Preparando', color: 'warning' },
            'listo': { priority: 3, label: 'Listo', color: 'success' },
            'entregando': { priority: 4, label: 'Entregando', color: 'primary' }
        };

        // Estados de items individuales
        const ITEM_STATES = {
            'pendiente': { label: 'Pendiente', color: 'danger' },
            'preparando': { label: 'Preparando', color: 'warning' },
            'listo': { label: 'Listo', color: 'success' }
        };

        // Permisos por rol
        const ROLE_PERMISSIONS = {
            'admin': ['dashboard', 'admin', 'kitchen', 'tables'],
            'cocina': ['dashboard', 'kitchen'],
            'chef': ['dashboard', 'kitchen'],
            'mesero': ['dashboard', 'admin', 'tables']
        };

        // Usuarios demo
        const demoUsers = {
            'admin@restaurante.com': {
                id: 1,
                nombre: 'Administrador',
                email: 'admin@restaurante.com',
                password: 'admin123',
                rol: 'admin'
            },
            'cocina@restaurante.com': {
                id: 2,
                nombre: 'Chef Principal',
                email: 'cocina@restaurante.com',
                password: 'cocina123',
                rol: 'cocina'
            },
            'chef@restaurante.com': {
                id: 3,
                nombre: 'Sous Chef',
                email: 'chef@restaurante.com',
                password: 'chef123',
                rol: 'cocina'
            }
        };

        // ==========================================
        // DATOS MOCK MEJORADOS
        // ==========================================
        
        function generateMockOrders() {
            const mockOrders = [
                {
                    id: 1,
                    mesa: 'Mesa 3',
                    mesaId: 3,
                    estado: 'preparando',
                    fecha_creacion: new Date(Date.now() - 15 * 60000).toISOString(),
                    total: 25500,
                    items: [
                        { 
                            id: 1, 
                            nombre: 'Hamburguesa Cl√°sica', 
                            cantidad: 2, 
                            precio: 8500, 
                            estado: 'preparando', 
                            observaciones: 'Sin cebolla, extra queso'
                        },
                        { 
                            id: 2, 
                            nombre: 'Papas Fritas', 
                            cantidad: 2, 
                            precio: 4000, 
                            estado: 'pendiente', 
                            observaciones: 'Extra crujientes'
                        },
                        { 
                            id: 3, 
                            nombre: 'Coca Cola', 
                            cantidad: 2, 
                            precio: 2500, 
                            estado: 'listo', 
                            observaciones: ''
                        }
                    ],
                    tiempoEstimado: 25,
                    cocineroAsignado: 'Chef Principal',
                    observacionesGenerales: 'Cliente con prisa'
                },
                {
                    id: 2,
                    mesa: 'Mesa 7',
                    mesaId: 7,
                    estado: 'pendiente',
                    fecha_creacion: new Date(Date.now() - 8 * 60000).toISOString(),
                    total: 18000,
                    items: [
                        { 
                            id: 4, 
                            nombre: 'Pizza Margherita', 
                            cantidad: 1, 
                            precio: 12000, 
                            estado: 'pendiente', 
                            observaciones: 'Extra queso, masa delgada'
                        },
                        { 
                            id: 5, 
                            nombre: 'Ensalada C√©sar', 
                            cantidad: 1, 
                            precio: 6000, 
                            estado: 'pendiente', 
                            observaciones: 'Sin pollo, extra crutones'
                        }
                    ],
                    tiempoEstimado: 30,
                    cocineroAsignado: 'Sous Chef',
                    observacionesGenerales: ''
                },
                {
                    id: 3,
                    mesa: 'Mesa 1',
                    mesaId: 1,
                    estado: 'listo',
                    fecha_creacion: new Date(Date.now() - 35 * 60000).toISOString(),
                    total: 16500,
                    items: [
                        { 
                            id: 6, 
                            nombre: 'Lomo a la Plancha', 
                            cantidad: 1, 
                            precio: 16500, 
                            estado: 'listo', 
                            observaciones: 'T√©rmino medio, con pur√©'
                        }
                    ],
                    tiempoEstimado: 0,
                    cocineroAsignado: 'Chef Principal',
                    observacionesGenerales: 'Mesa VIP'
                },
                {
                    id: 4,
                    mesa: 'Barra 2',
                    mesaId: 12,
                    estado: 'preparando',
                    fecha_creacion: new Date(Date.now() - 20 * 60000).toISOString(),
                    total: 22000,
                    items: [
                        { 
                            id: 7, 
                            nombre: 'Salm√≥n Grillado', 
                            cantidad: 1, 
                            precio: 18000, 
                            estado: 'preparando', 
                            observaciones: 'Con salsa teriyaki'
                        },
                        { 
                            id: 8, 
                            nombre: 'Vino Blanco', 
                            cantidad: 1, 
                            precio: 4000, 
                            estado: 'listo', 
                            observaciones: 'Bien fr√≠o'
                        }
                    ],
                    tiempoEstimado: 12,
                    cocineroAsignado: 'Chef Principal'
                }
            ];
            
            return mockOrders;
        }

        // ==========================================
        // FUNCIONES DE AUTENTICACI√ìN
        // ==========================================
        
        async function initializeApp() {
            console.log('üöÄ Inicializando aplicaci√≥n de cocina...');
            
            // Verificar si hay token guardado
            const savedToken = localStorage.getItem('authToken');
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedToken && savedUser) {
                try {
                    authToken = savedToken;
                    currentUser = JSON.parse(savedUser);
                    
                    // Verificar token con el servidor o usar demo
                    const isValid = await verifyToken();
                    if (isValid) {
                        showApp();
                        return;
                    }
                } catch (error) {
                    console.error('Token inv√°lido:', error);
                    clearAuthData();
                }
            }
            
            showLogin();
        }

        async function login(email, password) {
            try {
                // Verificar usuario demo primero
                const demoUser = demoUsers[email];
                if (demoUser && demoUser.password === password) {
                    currentUser = demoUser;
                    authToken = `demo-token-${demoUser.rol}-${Date.now()}`;
                    
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    return {
                        token: authToken,
                        user: currentUser,
                        message: 'Login demo exitoso'
                    };
                }

                // Intentar login real con API
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                if (!response.ok) {
                    throw new Error('Credenciales incorrectas');
                }

                const data = await response.json();
                
                authToken = data.token;
                currentUser = data.user;
                
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                return data;
                
            } catch (error) {
                console.error('‚ùå Error en login:', error);
                throw error;
            }
        }

        async function verifyToken() {
            try {
                if (!authToken) return false;
                
                // Si es token demo, permitir
                if (authToken.startsWith('demo-token')) {
                    isConnected = false; // Modo demo
                    updateConnectionStatus();
                    return true;
                }
                
                const response = await fetch(`${API_BASE_URL}/auth/verify`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    isConnected = true;
                    updateConnectionStatus();
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('Error verificando token:', error);
                isConnected = false;
                updateConnectionStatus();
                return false;
            }
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                clearAuthData();
                showLogin();
                showNotification('Sesi√≥n cerrada correctamente', 'success');
            }
        }

        function clearAuthData() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        function showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').classList.remove('authenticated');
        }

        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').classList.add('authenticated');
            
            // Actualizar informaci√≥n del usuario
            document.getElementById('user-name').textContent = currentUser.nombre;
            document.getElementById('user-role').textContent = currentUser.rol;
            
            // Configurar t√≠tulo seg√∫n rol
            const appTitle = document.getElementById('app-title');
            if (currentUser.rol === 'admin') {
                appTitle.textContent = 'Panel Administrador';
            } else {
                appTitle.textContent = 'Sistema Cocina';
            }
            
            // Configurar permisos de navegaci√≥n
            setupRolePermissions();
            
            // Cargar datos iniciales
            refreshDashboard();
            
            // Auto-refresh para cocina
            if (currentUser.rol === 'cocina' || currentUser.rol === 'chef') {
                startAutoRefresh();
            }
            
            showNotification(`Bienvenido, ${currentUser.nombre}`, 'success');
        }

        function setupRolePermissions() {
            const userRole = currentUser.rol;
            const allowedSections = ROLE_PERMISSIONS[userRole] || ['dashboard'];
            
            // Mostrar/ocultar tabs seg√∫n permisos
            document.querySelectorAll('.nav-tab').forEach(tab => {
                const sectionId = tab.onclick?.toString().match(/showSection\('(\w+)'/)?.[1];
                if (sectionId && !allowedSections.includes(sectionId)) {
                    tab.style.display = 'none';
                } else {
                    tab.style.display = 'block';
                }
            });
            
            // Si la secci√≥n actual no est√° permitida, ir a dashboard
            if (!allowedSections.includes(currentSection)) {
                showSection('dashboard');
            }
        }

        function updateConnectionStatus() {
            const statusDot = document.getElementById('connection-dot');
            const statusText = document.getElementById('connection-status');
            
            if (isConnected) {
                statusDot.classList.remove('offline');
                statusText.textContent = 'Conectado';
            } else {
                statusDot.classList.add('offline');
                statusText.textContent = authToken?.startsWith('demo-token') ? 'Modo Demo' : 'Sin conexi√≥n';
            }
        }

        // ==========================================
        // GESTI√ìN DE ITEMS INDIVIDUALES
        // ==========================================
        
        async function changeItemStatus(orderId, itemId, newStatus) {
            try {
                console.log(`üîÑ Actualizando item ${itemId} de orden ${orderId} a: ${newStatus}`);
                
                const response = await apiRequest(`/ordenes/${orderId}/items/${itemId}/estado`, {
                    method: 'PATCH',
                    body: JSON.stringify({ estado: newStatus })
                });
                
                if (response && response.success) {
                    // Actualizar localmente
                    orders = orders.map(order => {
                        if (order.id === orderId) {
                            const updatedItems = order.items.map(item => 
                                item.id === itemId ? { ...item, estado: newStatus } : item
                            );
                            
                            return {
                                ...order,
                                items: updatedItems,
                                estado: response.estadoOrden || order.estado
                            };
                        }
                        return order;
                    });
                    
                    refreshCurrentSection();
                    showNotification(`Item actualizado a: ${ITEM_STATES[newStatus].label}`, 'success');
                } else {
                    throw new Error(response?.message || 'Error actualizando item');
                }
                
            } catch (error) {
                console.error('‚ùå Error actualizando item:', error);
                showNotification('Error actualizando item', 'error');
                
                // Fallback: actualizar solo localmente
                orders = orders.map(order => {
                    if (order.id === orderId) {
                        const updatedItems = order.items.map(item => 
                            item.id === itemId ? { ...item, estado: newStatus } : item
                        );
                        
                        // Determinar estado general del pedido basado en items
                        let orderStatus = 'pendiente';
                        const allReady = updatedItems.every(item => item.estado === 'listo');
                        const somePrepairing = updatedItems.some(item => item.estado === 'preparando');
                        
                        if (allReady) {
                            orderStatus = 'listo';
                        } else if (somePrepairing) {
                            orderStatus = 'preparando';
                        }
                        
                        return {
                            ...order,
                            items: updatedItems,
                            estado: orderStatus
                        };
                    }
                    return order;
                });
                
                refreshCurrentSection();
            }
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                console.log(`üîÑ Actualizando orden ${orderId} a estado: ${newStatus}`);
                
                if (isConnected || authToken) {
                    // Usar API real
                    const response = await apiRequest(`/ordenes/${orderId}/estado`, {
                        method: 'PATCH',
                        body: JSON.stringify({ estado: newStatus })
                    });
                    
                    if (response && response.success) {
                        // Actualizar localmente
                        orders = orders.map(order => 
                            order.id === orderId ? { ...order, estado: newStatus } : order
                        );
                        
                        refreshCurrentSection();
                        showNotification(`Orden actualizada a: ${ORDER_STATES[newStatus]?.label || newStatus}`, 'success');
                        return response;
                    } else {
                        throw new Error(response?.message || 'Error actualizando orden');
                    }
                } else {
                    throw new Error('No hay conexi√≥n con el servidor');
                }
                
            } catch (error) {
                console.error('‚ùå Error actualizando orden:', error);
                showNotification('Error actualizando orden - usando modo local', 'error');
                
                // Fallback: actualizar solo localmente
                orders = orders.map(order => 
                    order.id === orderId ? { ...order, estado: newStatus } : order
                );
                refreshCurrentSection();
            }
        }

        // ==========================================
        // RENDERIZADO DE PEDIDOS MEJORADO
        // ==========================================
        
        function renderKitchenOrder(order, container) {
            const orderTime = new Date(order.fecha_creacion);
            const timeDiff = Math.floor((Date.now() - orderTime.getTime()) / 60000);
            const stateInfo = ORDER_STATES[order.estado] || ORDER_STATES['pendiente'];
            
            // Contar items por estado
            const itemsPendientes = order.items.filter(item => item.estado === 'pendiente').length;
            const itemsPreparando = order.items.filter(item => item.estado === 'preparando').length;
            const itemsListos = order.items.filter(item => item.estado === 'listo').length;
            
            const orderCard = document.createElement('div');
            orderCard.className = `order-card ${order.estado}`;
            
            orderCard.innerHTML = `
                <div class="order-header">
                    <div>
                        <div class="order-mesa">${order.mesa}</div>
                        <div class="order-time">
                            Hace ${timeDiff} min 
                            ${timeDiff > 30 ? '<span class="kitchen-timer">‚ö†Ô∏è URGENTE</span>' : ''}
                        </div>
                        <div class="order-total">$${order.total?.toLocaleString('es-CL') || '0'}</div>
                    </div>
                    <div>
                        <div class="order-status-badge status-${order.estado}">
                            ${stateInfo.label}
                        </div>
                        ${order.tiempoEstimado > 0 ? `
                            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
                                ‚è±Ô∏è ${order.tiempoEstimado} min estimados
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="order-items">
                    ${order.items.map(item => `
                        <div class="order-item">
                            <div class="item-info">
                                <div class="item-name">${item.nombre}</div>
                                <div class="item-details">
                                    <span class="item-quantity">${item.cantidad}x</span>
                                    <span class="item-price">$${(item.precio * item.cantidad).toLocaleString('es-CL')}</span>
                                    <span class="item-status status-${item.estado}">${ITEM_STATES[item.estado].label}</span>
                                </div>
                                ${item.observaciones ? `
                                    <div class="item-observations">üìù ${item.observaciones}</div>
                                ` : ''}
                            </div>
                            <div class="item-actions">
                                ${getItemActions(order.id, item)}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${order.observacionesGenerales ? `
                    <div class="order-observations ${timeDiff > 30 ? 'urgent' : ''}">
                        <span class="icon">${timeDiff > 30 ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                        ${order.observacionesGenerales}
                    </div>
                ` : ''}
                
                <div class="order-summary">
                    <div class="order-progress">
                        <div class="progress-item">
                            <span class="progress-count" style="background: var(--danger-color);">${itemsPendientes}</span>
                            <span>pendientes</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-count" style="background: var(--warning-color);">${itemsPreparando}</span>
                            <span>preparando</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-count" style="background: var(--success-color);">${itemsListos}</span>
                            <span>listos</span>
                        </div>
                    </div>
                    <div class="order-total-amount">
                        ${order.cocineroAsignado ? `üë®‚Äçüç≥ ${order.cocineroAsignado}` : ''}
                    </div>
                </div>
                
                <div class="order-actions">
                    <button class="btn btn-secondary" onclick="showOrderDetails(${order.id})">
                        üëÅÔ∏è Ver Detalles
                    </button>
                    ${order.estado === 'listo' ? `
                        <button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'entregado')">
                            ‚úÖ Marcar Entregado
                        </button>
                    ` : ''}
                    ${order.estado === 'pendiente' ? `
                        <button class="btn btn-warning" onclick="startAllItems(${order.id})">
                            üî• Comenzar Todo
                        </button>
                    ` : ''}
                </div>
            `;
            
            container.appendChild(orderCard);
        }

        function getItemActions(orderId, item) {
            switch(item.estado) {
                case 'pendiente':
                    return `<button class="item-btn start" onclick="changeItemStatus(${orderId}, ${item.id}, 'preparando')">
                        üî• Preparar
                    </button>`;
                case 'preparando':
                    return `<button class="item-btn finish" onclick="changeItemStatus(${orderId}, ${item.id}, 'listo')">
                        ‚úÖ Listo
                    </button>`;
                case 'listo':
                    return `<div class="item-btn completed">
                        ‚úÖ Completado
                    </div>`;
                default:
                    return '';
            }
        }

        function startAllItems(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.items.forEach(item => {
                    if (item.estado === 'pendiente') {
                        changeItemStatus(orderId, item.id, 'preparando');
                    }
                });
            }
        }

        // ==========================================
        // MODAL DE DETALLES
        // ==========================================
        
        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const modal = document.getElementById('order-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = `Detalles - ${order.mesa}`;
            
            const orderTime = new Date(order.fecha_creacion);
            const timeDiff = Math.floor((Date.now() - orderTime.getTime()) / 60000);
            
            modalBody.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Informaci√≥n General</h4>
                        <div style="space-y: 0.5rem;">
                            <p><strong>Mesa:</strong> ${order.mesa}</p>
                            <p><strong>Estado:</strong> <span class="order-status-badge status-${order.estado}">${ORDER_STATES[order.estado].label}</span></p>
                            <p><strong>Tiempo transcurrido:</strong> ${timeDiff} minutos</p>
                            <p><strong>Tiempo estimado:</strong> ${order.tiempoEstimado || 0} minutos</p>
                            <p><strong>Cocinero:</strong> ${order.cocineroAsignado || 'No asignado'}</p>
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Resumen</h4>
                        <div style="space-y: 0.5rem;">
                            <p><strong>Total items:</strong> ${order.items.length}</p>
                            <p><strong>Items pendientes:</strong> ${order.items.filter(i => i.estado === 'pendiente').length}</p>
                            <p><strong>Items preparando:</strong> ${order.items.filter(i => i.estado === 'preparando').length}</p>
                            <p><strong>Items listos:</strong> ${order.items.filter(i => i.estado === 'listo').length}</p>
                            <p><strong>Total:</strong> <span style="font-size: 1.2rem; color: var(--primary-color);">$${order.total.toLocaleString('es-CL')}</span></p>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Items del Pedido</h4>
                <div style="space-y: 1rem;">
                    ${order.items.map(item => `
                        <div class="order-item" style="margin-bottom: 1rem;">
                            <div class="item-info">
                                <div class="item-name">${item.nombre}</div>
                                <div class="item-details">
                                    <span class="item-quantity">${item.cantidad}x</span>
                                    <span class="item-price">$${(item.precio * item.cantidad).toLocaleString('es-CL')}</span>
                                    <span class="item-status status-${item.estado}">${ITEM_STATES[item.estado].label}</span>
                                </div>
                                ${item.observaciones ? `
                                    <div class="item-observations">üìù ${item.observaciones}</div>
                                ` : ''}
                            </div>
                            <div class="item-actions">
                                ${getItemActions(order.id, item)}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${order.observacionesGenerales ? `
                    <div class="order-observations" style="margin-top: 2rem;">
                        <span class="icon">‚ÑπÔ∏è</span>
                        <strong>Observaciones generales:</strong> ${order.observacionesGenerales}
                    </div>
                ` : ''}
            `;
            
            modal.style.display = 'flex';
        }

        function closeOrderModal() {
            document.getElementById('order-modal').style.display = 'none';
        }

        // ==========================================
        // NAVEGACI√ìN Y CARGA DE DATOS
        // ==========================================
        
        function showSection(sectionName) {
            // Verificar permisos
            if (currentUser) {
                const userRole = currentUser.rol;
                const allowedSections = ROLE_PERMISSIONS[userRole] || ['dashboard'];
                
                if (!allowedSections.includes(sectionName)) {
                    showNotification('No tienes permisos para acceder a esta secci√≥n', 'error');
                    return;
                }
            }
            
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Quitar clase active de todos los tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Activar tab correspondiente
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            currentSection = sectionName;
            
            // Cargar datos espec√≠ficos de la secci√≥n
            loadSectionData(sectionName);
        }

        function loadSectionData(section) {
            if (!currentUser) return;
            
            switch(section) {
                case 'dashboard':
                    refreshDashboard();
                    break;
                case 'kitchen':
                    refreshKitchenOrders();
                    break;
                case 'admin':
                    refreshOrders();
                    break;
                case 'tables':
                    refreshTables();
                    break;
            }
        }

        async function refreshDashboard() {
            showLoading('dashboard-orders');
            
            try {
                orders = await getOrders();
                updateDashboardStats();
                renderOrdersInContainer('dashboard-orders', orders.slice(0, 6), false);
            } catch (error) {
                showError('dashboard-orders', 'Error cargando el dashboard');
            }
        }

        async function refreshKitchenOrders() {
            showLoading('kitchen-orders');
            
            try {
                console.log('üç≥ Cargando √≥rdenes de cocina con orden FIFO...');
                
                // Usar endpoint espec√≠fico de cocina que ya devuelve orden FIFO
                const kitchenOrders = await getActiveOrders();
                
                const container = document.getElementById('kitchen-orders');
                container.innerHTML = '';
                
                if (kitchenOrders.length === 0) {
                    container.innerHTML = `
                        <div class="no-orders">
                            <div class="icon">üë®‚Äçüç≥</div>
                            <h3>No hay pedidos activos</h3>
                            <p>Los nuevos pedidos aparecer√°n aqu√≠ autom√°ticamente</p>
                            <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
                                ${isConnected ? 'üåê Conectado al servidor' : 'üì± Modo local'}
                            </p>
                        </div>
                    `;
                    return;
                }
                
                // Las √≥rdenes ya vienen ordenadas por FIFO desde la API
                console.log(`‚úÖ ${kitchenOrders.length} √≥rdenes activas cargadas (FIFO)`);
                
                // Mostrar informaci√≥n de FIFO
                if (kitchenOrders.length > 0) {
                    const oldest = kitchenOrders[0];
                    console.log(`üìÖ Orden m√°s antigua: ${oldest.mesa} (${oldest.tiempo_transcurrido} min)`);
                }
                
                kitchenOrders.forEach(order => renderKitchenOrder(order, container));
                
                // Actualizar las √≥rdenes globales para otras vistas
                orders = kitchenOrders;
                
            } catch (error) {
                console.error('‚ùå Error cargando √≥rdenes de cocina:', error);
                showError('kitchen-orders', 'Error cargando pedidos de cocina');
            }
        }

        async function refreshOrders() {
            showLoading('admin-orders');
            
            try {
                orders = await getOrders();
                renderOrdersInContainer('admin-orders', orders, false);
            } catch (error) {
                showError('admin-orders', 'Error cargando pedidos');
            }
        }

        async function refreshTables() {
            showLoading('tables-grid');
            
            try {
                tables = await getTables();
                renderTablesInContainer('tables-grid', tables);
            } catch (error) {
                showError('tables-grid', 'Error cargando mesas');
            }
        }

        async function getOrders() {
            try {
                console.log('üìù Obteniendo √≥rdenes desde API...');
                
                if (isConnected && authToken) {
                    // Intentar usar API real
                    const response = await apiRequest('/ordenes');
                    if (response && Array.isArray(response)) {
                        console.log(`‚úÖ ${response.length} √≥rdenes obtenidas desde API`);
                        return response;
                    }
                }
                
                // Fallback a datos mock si API no est√° disponible
                console.log('‚ö†Ô∏è Usando datos mock - API no disponible');
                return generateMockOrders();
                
            } catch (error) {
                console.error('‚ùå Error obteniendo √≥rdenes:', error);
                showNotification('Usando datos de prueba - servidor no disponible', 'warning');
                return generateMockOrders();
            }
        }

        async function getActiveOrders() {
            try {
                console.log('üç≥ Obteniendo √≥rdenes activas para cocina...');
                
                if (isConnected || authToken) {
                    // Usar endpoint espec√≠fico de cocina con orden FIFO
                    const response = await fetch(`${API_BASE_URL}/ordenes/activas`, {
                        headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (Array.isArray(data)) {
                            console.log(`‚úÖ ${data.length} √≥rdenes activas obtenidas (FIFO)`);
                            return data;
                        }
                    }
                }
                
                // Fallback: filtrar datos mock para cocina
                console.log('‚ö†Ô∏è Usando datos mock filtrados para cocina');
                const mockOrders = generateMockOrders();
                return mockOrders.filter(order => 
                    ['pendiente', 'preparando', 'listo'].includes(order.estado)
                ).sort((a, b) => new Date(a.fecha_creacion) - new Date(b.fecha_creacion)); // FIFO
                
            } catch (error) {
                console.error('‚ùå Error obteniendo √≥rdenes activas:', error);
                const mockOrders = generateMockOrders();
                return mockOrders.filter(order => 
                    ['pendiente', 'preparando', 'listo'].includes(order.estado)
                );
            }
        }

        async function getTables() {
            // Generar mesas mock (misma l√≥gica que antes)
            const mockTables = [];
            for(let i = 1; i <= 12; i++) {
                mockTables.push({
                    id: i,
                    numero: `Mesa ${i}`,
                    capacidad: Math.floor(Math.random() * 4) + 2,
                    estado: ['disponible', 'ocupada', 'reservada'][Math.floor(Math.random() * 3)],
                    activa: true
                });
            }
            return mockTables;
        }

        function refreshCurrentSection() {
            if (!currentUser) return;
            
            switch(currentSection) {
                case 'dashboard':
                    refreshDashboard();
                    break;
                case 'kitchen':
                    refreshKitchenOrders();
                    break;
                case 'admin':
                    refreshOrders();
                    break;
                case 'tables':
                    refreshTables();
                    break;
            }
        }

        function renderOrdersInContainer(containerId, ordersList, isKitchen = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (ordersList.length === 0) {
                container.innerHTML = '<div class="no-orders">üìù No hay pedidos para mostrar</div>';
                return;
            }
            
            // Ordenar por prioridad de estado y tiempo
            const sortedOrders = ordersList.sort((a, b) => {
                const priorityDiff = (ORDER_STATES[a.estado]?.priority || 5) - (ORDER_STATES[b.estado]?.priority || 5);
                if (priorityDiff !== 0) return priorityDiff;
                return new Date(a.fecha_creacion) - new Date(b.fecha_creacion);
            });
            
            if (isKitchen) {
                sortedOrders.forEach(order => renderKitchenOrder(order, container));
            } else {
                sortedOrders.forEach(order => renderOrder(order, container, false));
            }
        }

        function renderOrder(order, container, isKitchen = false) {
            const orderTime = new Date(order.fecha_creacion);
            const timeDiff = Math.floor((Date.now() - orderTime.getTime()) / 60000);
            const stateInfo = ORDER_STATES[order.estado] || ORDER_STATES['pendiente'];
            
            const orderCard = document.createElement('div');
            orderCard.className = `order-card ${order.estado}`;
            orderCard.innerHTML = `
                <div class="order-header">
                    <div>
                        <div class="order-mesa">${order.mesa}</div>
                        <div class="order-time">Hace ${timeDiff} min</div>
                    </div>
                    <div>
                        <span class="order-status-badge status-${order.estado}">${stateInfo.label}</span>
                    </div>
                </div>
                
                <div class="order-items">
                    ${order.items.map(item => `
                        <div class="order-item">
                            <div class="item-name">${item.cantidad}x ${item.nombre}</div>
                            <div class="item-quantity">${item.cantidad}</div>
                        </div>
                    `).join('')}
                    
                    <div class="order-total-amount" style="text-align: right; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                        Total: $${order.total?.toLocaleString('es-CL') || '0'}
                    </div>
                </div>
                
                <div class="order-actions">
                    <button class="btn btn-secondary" onclick="showOrderDetails(${order.id})">
                        üëÅÔ∏è Ver
                    </button>
                    ${getOrderActions(order, isKitchen)}
                </div>
            `;
            
            container.appendChild(orderCard);
        }

        function getOrderActions(order, isKitchen = false) {
            const actions = [];
            
            if (isKitchen) {
                switch(order.estado) {
                    case 'pendiente':
                        actions.push(`<button class="btn btn-warning" onclick="updateOrderStatus(${order.id}, 'preparando')">üî• Comenzar</button>`);
                        break;
                    case 'preparando':
                        actions.push(`<button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'listo')">‚úÖ Listo</button>`);
                        break;
                    case 'listo':
                        actions.push(`<button class="btn btn-primary" onclick="updateOrderStatus(${order.id}, 'entregando')">üöö Entregar</button>`);
                        break;
                }
            } else {
                switch(order.estado) {
                    case 'pendiente':
                        actions.push(`<button class="btn btn-warning" onclick="updateOrderStatus(${order.id}, 'preparando')">‚û°Ô∏è A Cocina</button>`);
                        break;
                    case 'preparando':
                        actions.push(`<button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'listo')">‚úÖ Marcar Listo</button>`);
                        break;
                    case 'listo':
                        actions.push(`<button class="btn btn-primary" onclick="updateOrderStatus(${order.id}, 'entregando')">üöö Entregando</button>`);
                        break;
                    case 'entregando':
                        actions.push(`<button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'completado')">‚úÖ Completar</button>`);
                        break;
                }
                
                if (order.estado !== 'completado' && currentUser && ['admin'].includes(currentUser.rol)) {
                    actions.push(`<button class="btn btn-danger" onclick="cancelOrder(${order.id})">‚ùå Cancelar</button>`);
                }
            }
            
            return actions.join('');
        }

        function renderTablesInContainer(containerId, tablesList) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (tablesList.length === 0) {
                container.innerHTML = '<div class="no-orders">ü™ë No hay mesas configuradas</div>';
                return;
            }
            
            tablesList.forEach(table => renderTable(table, container));
        }

        function renderTable(table, container) {
            const tableCard = document.createElement('div');
            tableCard.className = `table-card ${table.estado}`;
            tableCard.innerHTML = `
                <div class="table-number">${table.numero}</div>
                <div class="table-status">${table.estado}</div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                    üë• ${table.capacidad} personas
                </div>
            `;
            
            tableCard.onclick = () => selectTable(table);
            container.appendChild(tableCard);
        }

        function selectTable(table) {
            showNotification(`Mesa seleccionada: ${table.numero}`, 'info');
        }

        function updateDashboardStats() {
            const pending = orders.filter(o => o.estado === 'pendiente').length;
            const preparing = orders.filter(o => o.estado === 'preparando').length;
            const ready = orders.filter(o => o.estado === 'listo').length;
            const totalSales = orders.reduce((sum, order) => sum + (order.total || 0), 0);
            
            document.getElementById('pending-orders').textContent = pending;
            document.getElementById('preparing-orders').textContent = preparing;
            document.getElementById('ready-orders').textContent = ready;
            document.getElementById('total-sales').textContent = `$${totalSales.toLocaleString('es-CL')}`;
        }

        // ==========================================
        // AUTO-REFRESH Y UTILIDADES
        // ==========================================
        
        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            autoRefreshInterval = setInterval(() => {
                if (currentSection === 'kitchen' && currentUser) {
                    refreshKitchenOrders();
                }
            }, 15000); // Actualizar cada 15 segundos en cocina
        }

        function toggleAutoRefresh() {
            const btn = document.getElementById('auto-refresh-btn');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                btn.innerHTML = '‚ùå Inactivo';
                btn.className = 'btn btn-danger';
            } else {
                startAutoRefresh();
                btn.innerHTML = '‚úÖ Activo';
                btn.className = 'btn btn-success';
            }
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Cargando...</div>
                </div>
            `;
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="no-orders">
                    <div class="icon">‚ùå</div>
                    <h3>${message}</h3>
                    <button class="btn btn-primary" onclick="refreshCurrentSection()" style="margin-top: 1rem;">
                        üîÑ Reintentar
                    </button>
                </div>
            `;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            messageElement.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        async function cancelOrder(orderId) {
            if (confirm('¬øEst√°s seguro de que quieres cancelar este pedido?')) {
                try {
                    await updateOrderStatus(orderId, 'cancelado');
                    showNotification('Pedido cancelado', 'warning');
                } catch (error) {
                    showNotification('Error cancelando pedido', 'error');
                }
            }
        }

        // ==========================================
        // MANEJO DEL FORMULARIO DE LOGIN
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar selectores de rol
            document.querySelectorAll('.role-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.role-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedRole = this.dataset.role;
                });
            });

            // Manejar env√≠o del formulario
            document.getElementById('login-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const loginBtn = document.getElementById('login-btn');
                const loginBtnText = document.getElementById('login-btn-text');
                const loginError = document.getElementById('login-error');
                
                // Limpiar errores anteriores
                clearFormErrors();
                
                // Validaciones b√°sicas
                if (!email) {
                    showFieldError('email', 'El email es requerido');
                    return;
                }
                
                if (!password) {
                    showFieldError('password', 'La contrase√±a es requerida');
                    return;
                }
                
                // Deshabilitar bot√≥n y mostrar loading
                loginBtn.disabled = true;
                loginBtnText.innerHTML = '<div class="login-loading"><div class="loading-spinner" style="width: 16px; height: 16px;"></div> Iniciando sesi√≥n...</div>';
                
                try {
                    const loginResponse = await login(email, password);
                    
                    if (loginResponse && loginResponse.user) {
                        showApp();
                    } else {
                        throw new Error('Respuesta de login inv√°lida');
                    }
                    
                } catch (error) {
                    console.error('Error en login:', error);
                    loginError.textContent = error.message || 'Credenciales incorrectas. Intenta nuevamente.';
                } finally {
                    // Rehabilitar bot√≥n
                    loginBtn.disabled = false;
                    loginBtnText.textContent = 'Iniciar Sesi√≥n';
                }
            });

            // Cerrar modal al hacer clic fuera
            document.getElementById('order-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeOrderModal();
                }
            });

            // Inicializar aplicaci√≥n
            initializeApp();
        });
        
        function clearFormErrors() {
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.error-message').forEach(error => {
                error.textContent = '';
            });
        }
        
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(`${fieldId}-error`);
            
            field.classList.add('error');
            errorElement.textContent = message;
        }

        // Manejar visibilidad de p√°gina
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                }
            } else {
                if (currentSection === 'kitchen' && currentUser && (currentUser.rol === 'cocina' || currentUser.rol === 'chef')) {
                    startAutoRefresh();
                }
            }
        });
    </script>
</body>
</html>